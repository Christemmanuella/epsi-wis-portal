<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EPSI-WIS Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #0a192f, #1e3a8a);
      color: #ffffff;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    .header {
      background: #2B1C4D;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .header .logo-container img {
      height: 60px;
      margin: 0 10px;
      transition: transform 0.3s ease;
    }
    .header .logo-container img:hover {
      transform: scale(1.1);
    }
    .profile-initials {
      height: 120px;
      width: 120px;
      background: #00ffcc;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #2B1C4D;
      font-weight: bold;
      font-size: 2em;
      transition: transform 0.3s ease;
      margin: 0 auto 10px auto;
    }
    .profile-initials:hover {
      transform: scale(1.1);
    }
    .navbar {
      background: #2B1C4D;
      padding: 0;
    }
    .navbar-nav .nav-link {
      color: #ffffff !important;
      font-weight: 600;
      margin: 0 15px;
      transition: color 0.3s ease;
    }
    .navbar-nav .nav-link:hover {
      color: #00ffcc !important;
    }
    .section {
      padding: 40px 20px;
      animation: fadeIn 1s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #00ffcc;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(5px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 255, 204, 0.3);
    }
    .btn-custom {
      background: linear-gradient(45deg, #00ffcc, #ff00ff);
      color: #2B1C4D;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      transition: transform 0.3s ease, background 0.3s ease;
    }
    .btn-custom:hover {
      transform: scale(1.05);
      background: linear-gradient(45deg, #ff00ff, #00ffcc);
    }
    .error {
      color: #ff4d4d;
      font-size: 0.9em;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .profile-img {
      max-width: 150px;
      border-radius: 50%;
      border: 3px solid #00ffcc;
      margin-bottom: 20px;
      transition: transform 0.3s ease;
    }
    .profile-img:hover {
      transform: rotate(5deg) scale(1.1);
    }
    #profileSection .form-group {
      margin-bottom: 15px;
    }
    #dashboardSection, #profileSection {
      min-height: 80vh;
    }
    .animated-text {
      animation: slideIn 1s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .dashboard-band {
      background: rgba(0, 255, 204, 0.1);
      padding: 20px;
      margin-bottom: 20px;
      border-left: 5px solid #00ffcc;
    }
    .dashboard-band ul {
      list-style-type: none;
      padding: 0;
      color: #ffffff;
    }
    .dashboard-band ul li {
      margin: 10px 0;
      font-size: 1.1em;
    }
    .profile-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .profile-table th, .profile-table td {
      border: 1px solid #00ffcc;
      padding: 10px;
      text-align: left;
      color: #ffffff;
    }
    .profile-table th {
      background: rgba(0, 255, 204, 0.2);
    }
    .profile-initials-container {
      text-align: center;
      margin-bottom: 0;
    }
    .profile-name {
      text-align: center;
      font-size: 1.2em;
      margin-bottom: 20px;
      color: #ffffff;
    }
    label, h2, h3, h4, h5, p, a {
      color: #ffffff !important;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 80%;
      max-width: 400px;
      background-color: #000000; /* Fond noir pour les pop-ups */
      color: #ffffff; /* Texte en blanc pour lisibilit√© */
    }
  </style>
</head>
<body>
  <!-- En-t√™te avec logos et menu -->
  <div class="header" id="header" style="display: none;">
    <div class="logo-container">
      <img src="/static/assets/epsi_logo.png" alt="EPSI Logo">
      <img src="/static/assets/wis_logo.png" alt="WIS Logo" style="height: 60px;">
    </div>
    <div id="profileImageHeader" class="profile-initials" style="margin-right: 20px;"></div>
    <nav class="navbar navbar-expand-lg">
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#" id="homeLink">Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="profileLink">Profil</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="logout">D√©connexion</a></li>
        </ul>
      </div>
    </nav>
  </div>

  <!-- Inscription -->
  <div class="container mt-5 section" id="registerSection" style="display: block;">
    <div class="card">
      <h2 class="text-center mb-4 animated-text">Inscription</h2>
      <form id="registerForm">
        <div class="mb-3">
          <label class="form-label">Formation</label>
          <select class="form-select" id="formation" name="formation" required>
            <option value="">Choisir une formation</option>
            <option value="ASRBD">ASRBD</option>
            <option value="EISI">EISI</option>
            <option value="DEVIA">DEVIA</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Email EPSI/WIS</label>
          <input type="email" class="form-control" id="email" name="email" required>
          <div id="emailError" class="error"></div>
        </div>
        <button type="submit" class="btn btn-custom w-100">Suivant</button>
        <a href="#" class="btn btn-outline-light mt-2 w-100" id="loginLink">D√©j√† inscrit ? Connectez-vous</a>
      </form>
    </div>
  </div>

  <!-- Connexion -->
  <div class="container mt-5 section" id="loginSection" style="display: none;">
    <div class="card">
      <h2 class="text-center mb-4 animated-text">Connexion</h2>
      <form id="loginForm">
        <div class="mb-3">
          <label class="form-label">Email EPSI/WIS</label>
          <input type="email" class="form-control" id="loginEmail" name="loginEmail" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Mot de passe</label>
          <input type="password" class="form-control" id="loginPassword" name="loginPassword" required>
        </div>
        <button type="submit" class="btn btn-custom w-100">Se connecter</button>
        <a href="#" class="btn btn-outline-light mt-2 w-100" id="registerLink">Pas de compte ? Inscrivez-vous</a>
      </form>
      <div id="loginError" class="error"></div>
    </div>
  </div>

  <!-- Formulaire sp√©cifique -->
  <div class="container mt-5 section" id="formSection" style="display: none;">
    <div class="card">
      <h2 class="text-center mb-4 animated-text" id="formTitle"></h2>
      <form id="specificForm">
        <div id="formFields"></div>
        <div class="mb-3">
          <label class="form-label">Nouveau mot de passe</label>
          <input type="password" class="form-control" id="newPassword" name="newPassword" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Confirmer le mot de passe</label>
          <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
        </div>
        <button type="submit" class="btn btn-custom w-100 mt-3">Soumettre</button>
        <button type="button" class="btn btn-outline-light w-100 mt-2" id="backButton">Retour</button>
        <div id="formError" class="error"></div>
      </form>
    </div>
  </div>

  <!-- Page d'accueil -->
  <div class="container mt-5 section" id="dashboardSection" style="display: none;">
    <div class="card">
      <h2 class="text-center mb-4 animated-text" id="welcomeMessage"></h2>
      <div class="dashboard-content" id="dashboardContent"></div>
    </div>
  </div>

  <!-- Page Profil -->
  <div class="container mt-5 section" id="profileSection" style="display: none;">
    <div class="card">
      <h2 class="text-center mb-4 animated-text">Profil</h2>
      <div class="profile-initials-container">
        <div id="profileImage" class="profile-initials"></div>
        <div id="profileName" class="profile-name"></div>
        <span id="cameraIcon" class="camera">üì∑</span>
        <input type="file" id="profileUpload" accept="image/*" style="display: none;">
      </div>
      <table class="profile-table" id="profileData"></table>
      <div class="text-center mt-3">
        <button class="btn btn-custom mt-3" id="changeFormation">Changer de formation</button>
        <button class="btn btn-custom mt-3 ms-3" id="editProfile">Modifier</button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmation -->
  <div id="confirmationModal" class="modal">
    <div class="modal-content">
      <h3 class="text-center">Confirmation</h3>
      <p class="text-center">√ätes-vous s√ªr de vos informations ?</p>
      <button class="btn btn-custom mt-3" id="confirmSubmit">Confirmer</button>
      <button class="btn btn-outline-light mt-3" id="cancelSubmit">Annuler</button>
    </div>
  </div>

  <!-- Message de succ√®s -->
  <div id="successMessage" class="modal" style="display: none;">
    <div class="modal-content">
      <h3 class="text-center">Succ√®s</h3>
      <p class="text-center">Votre formulaire a √©t√© soumis avec succ√®s !</p>
      <button class="btn btn-custom mt-3" id="closeSuccess">OK</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let userData = JSON.parse(localStorage.getItem('userData')) || {};

    window.onload = function() {
        if (!userData.email || !userData.password) {
            userData = {};
            localStorage.removeItem('userData');
            document.getElementById('header').style.display = 'none';
            document.getElementById('registerSection').style.display = 'block';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'none';
        } else {
            validateSession();
        }
    };

    function validateSession() {
        fetch(`http://localhost:5000/validate_session?email=${encodeURIComponent(userData.email)}`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.valid) {
                document.getElementById('header').style.display = 'flex';
                document.getElementById('registerSection').style.display = 'none';
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('dashboardSection').style.display = 'block';
                loadDashboard();
            } else {
                userData = {};
                localStorage.removeItem('userData');
                document.getElementById('header').style.display = 'none';
                document.getElementById('registerSection').style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Erreur de validation:', error);
            userData = {};
            localStorage.removeItem('userData');
            document.getElementById('header').style.display = 'none';
            document.getElementById('registerSection').style.display = 'block';
        });
    }

    document.getElementById('homeLink').addEventListener('click', function(e) {
        e.preventDefault();
        if (userData.email && userData.password) {
            document.getElementById('profileSection').style.display = 'none';
            loadDashboard();
        } else {
            document.getElementById('registerSection').style.display = 'block';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'none';
        }
    });

    document.getElementById('profileLink').addEventListener('click', function(e) {
        e.preventDefault();
        if (userData.email && userData.password) {
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'block';
            loadProfile();
        } else {
            document.getElementById('registerSection').style.display = 'block';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'none';
        }
    });

    document.getElementById('loginLink').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('registerSection').style.display = 'none';
        document.getElementById('loginSection').style.display = 'block';
    });

    document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formation = document.getElementById('formation').value;
        const email = document.getElementById('email').value;
        const emailError = document.getElementById('emailError');
        if (!email.endsWith('@ecoles-epsi.net') && !email.endsWith('@ecoles-wis.net')) {
            emailError.textContent = 'Veuillez entrer un email EPSI/WIS valide.';
            return;
        }
        emailError.textContent = '';
        fetch('http://localhost:5000/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: email, formation: formation })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                emailError.textContent = data.error;
            } else {
                userData.email = data.email;
                userData.formation = data.formation;
                localStorage.setItem('userData', JSON.stringify(userData));
                document.getElementById('registerSection').style.display = 'none';
                if (data.next === 'form') {
                    loadForm();
                }
            }
        })
        .catch(error => console.error('Erreur:', error));
    });

    document.getElementById('registerLink').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('registerSection').style.display = 'block';
    });

    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const loginEmail = document.getElementById('loginEmail').value;
        const loginPassword = document.getElementById('loginPassword').value;
        fetch('http://localhost:5000/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: loginEmail, password: loginPassword })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                document.getElementById('loginError').textContent = data.error;
            } else {
                userData.email = loginEmail;
                userData.password = loginPassword;
                userData.formation = data.formation;
                localStorage.setItem('userData', JSON.stringify(userData));
                document.getElementById('header').style.display = 'flex';
                document.getElementById('loginSection').style.display = 'none';
                if (data.next === 'dashboard') {
                    loadDashboard();
                }
            }
        })
        .catch(error => console.error('Erreur:', error));
    });

    function loadForm() {
        const formation = userData.formation || localStorage.getItem('formation_' + userData.email);
        document.getElementById('formTitle').textContent = `Formulaire ${formation}`;
        let fields = {};
        if (formation === 'ASRBD') {
            fields = {
                'Civilit√©': 'select', 'Nom': 'text', 'Pr√©nom': 'text', 'Date de Naissance': 'date',
                'Lieu de Naissance': 'text', 'D√©partement de Naissance': 'text', 'Pays': 'text',
                'Adresse': 'text', 'CP': 'text', 'Ville': 'text', 'Tel Fixe': 'tel',
                'Tel Mobile': 'tel', 'Adresse mail personnelle': 'email',
                'Dipl√¥me ou niveau d‚Äô√©tudes': 'text', 'Exp√©rience professionnelle': 'text',
                'Financement': 'text'
            };
        } else if (formation === 'EISI' || formation === 'DEVIA') {
            fields = {
                'Civilit√©': 'select', 'ID Candidat (IGOR)': 'text', 'Identifiant candidat': 'text', 'Campus': 'text',
                'Nom de naissance': 'text', 'Pr√©nom': 'text',
                'Date de naissance': 'date', 'Code postal ville de naissance': 'text',
                'Lieu de naissance (Ville)': 'text', 'Pays de naissance': 'text',
                'Nationalit√©': 'text', 'Intitul√© du dernier dipl√¥me': 'text',
                'Niveau du dernier dipl√¥me': 'text', 'Ann√©e d‚Äôobtention': 'number',
                'D√©cision du jury': 'text', 'Ann√©e de premi√®re inscription': 'number',
                'Voie d‚Äôacc√®s': 'text', 'Situation avant cursus': 'text',
                'Dernier m√©tier exerc√©': 'text', 'Nom de l‚Äôentreprise': 'text',
                'Dur√©e de l‚Äôexp√©rience': 'number', 'T√©l√©phone portable personnel': 'tel',
                'Adresse mail personnelle': 'email'
            };
        }
        let fieldsHtml = '';
        for (let field in fields) {
            if (fields[field] === 'select' && field === 'Civilit√©') {
                fieldsHtml += `<div class="mb-3"><label class="form-label">${field}</label><select class="form-control" name="${field.toLowerCase().replace(/ /g, '_')}" required><option value="">Choisir</option><option value="Monsieur">Monsieur</option><option value="Madame">Madame</option></select></div>`;
            } else {
                fieldsHtml += `<div class="mb-3"><label class="form-label">${field}</label><input type="${fields[field]}" class="form-control" name="${field.toLowerCase().replace(/ /g, '_')}" required></div>`;
            }
        }
        document.getElementById('formFields').innerHTML = fieldsHtml;
        document.getElementById('formSection').style.display = 'block';
    }

    document.getElementById('specificForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const form = this;
        let isValid = true;
        let formData = {};
        form.querySelectorAll('input[required], select[required]').forEach(input => {
            const errorDiv = document.getElementById(`${input.name}_error`) || document.createElement('div');
            if (!errorDiv.parentElement) {
                errorDiv.className = 'error';
                errorDiv.id = `${input.name}_error`;
                input.parentElement.appendChild(errorDiv);
            }
            errorDiv.textContent = '';
            if (!input.value || (input.nodeName === 'SELECT' && input.value === '')) {
                errorDiv.textContent = 'Veuillez remplir ce champ.';
                isValid = false;
            } else {
                const fieldName = input.name.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase()).replace(/ /g, '_');
                formData[fieldName] = input.value;
            }
        });
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        let passwordError = document.getElementById('newpassword_error');
        if (!passwordError) {
            passwordError = document.createElement('div');
            passwordError.className = 'error';
            passwordError.id = 'newpassword_error';
            document.getElementById('newPassword').parentElement.appendChild(passwordError);
        }
        passwordError.textContent = '';
        if (newPassword !== confirmPassword) {
            passwordError.textContent = 'Les mots de passe ne correspondent pas.';
            isValid = false;
        } else if (newPassword.length < 8) {
            passwordError.textContent = 'Le mot de passe doit contenir au moins 8 caract√®res.';
            isValid = false;
        } else {
            formData['Password'] = newPassword;
        }
        if (isValid) {
            document.getElementById('confirmationModal').style.display = 'block';
            window.formData = formData;
            console.log('Donn√©es envoy√©es au serveur:', formData); // D√©bogage
        }
    });

    document.getElementById('confirmSubmit').addEventListener('click', function() {
        document.getElementById('confirmationModal').style.display = 'none';
        fetch('http://localhost:5000/submit_form', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ...window.formData, email: userData.email, formation: userData.formation })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                document.getElementById('formError').textContent = data.error;
            } else {
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                window.formData = {};
                userData = {};
                localStorage.removeItem('userData');
                document.getElementById('header').style.display = 'none';
                document.getElementById('loginSection').style.display = 'block';
            }
        })
        .catch(error => console.error('Erreur:', error));
    });

    document.getElementById('cancelSubmit').addEventListener('click', function() {
        document.getElementById('confirmationModal').style.display = 'none';
    });

    document.getElementById('closeSuccess').addEventListener('click', function() {
        document.getElementById('successMessage').style.display = 'none';
        userData = {};
        localStorage.removeItem('userData');
        document.getElementById('header').style.display = 'none';
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('loginEmail').value = userData.email || '';
    });

    document.getElementById('backButton').addEventListener('click', function() {
        document.getElementById('formSection').style.display = 'none';
        userData = {};
        localStorage.removeItem('userData');
        document.getElementById('header').style.display = 'none';
        document.getElementById('registerSection').style.display = 'block';
        document.getElementById('email').value = userData.email || '';
    });

    function loadDashboard() {
        document.getElementById('dashboardSection').style.display = 'block';
        document.getElementById('registerSection').style.display = 'none';
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('formSection').style.display = 'none';
        document.getElementById('profileSection').style.display = 'none';
        fetch(`http://localhost:5000/user_data?email=${encodeURIComponent(userData.email)}`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            const formation = data.formation;
            let dashboardContent = '';
            document.getElementById('welcomeMessage').textContent = `Bienvenue dans la Formation ${formation}`;
            if (formation === 'ASRBD') {
                dashboardContent = `
                    <div class="dashboard-band">
                        <h4>ASRBD ‚Äì Administration, S√©curit√© des R√©seaux et Base de Donn√©es</h4>
                    </div>
                    <div class="dashboard-band">
                        <h5>Objectifs :</h5>
                        <ul>
                            <li class="dashboard-band">Former des administrateurs syst√®mes et r√©seaux capables de g√©rer des infrastructures complexes.</li>
                            <li class="dashboard-band">D√©velopper des comp√©tences en cybers√©curit√© et gestion des bases de donn√©es.</li>
                            <li class="dashboard-band">Pr√©parer aux m√©tiers li√©s √† la maintenance, s√©curit√©, virtualisation, cloud computing et data management.</li>
                        </ul>
                    </div>
                    <div class="dashboard-band">
                        <h5>Programme type :</h5>
                        <ul>
                            <li class="dashboard-band">Syst√®mes d‚Äôexploitation (Linux, Windows Server)</li>
                            <li class="dashboard-band">Administration r√©seaux (TCP/IP, DHCP, DNS, VLAN, routage, firewall‚Ä¶)</li>
                            <li class="dashboard-band">S√©curit√© informatique (chiffrement, attaques, d√©fense, audits‚Ä¶)</li>
                            <li class="dashboard-band">Virtualisation & cloud (VMware, Hyper-V, Azure, AWS‚Ä¶)</li>
                            <li class="dashboard-band">Scripting (PowerShell, Bash)</li>
                            <li class="dashboard-band">Bases de donn√©es (SQL Server, MySQL, Oracle‚Ä¶)</li>
                            <li class="dashboard-band">Sauvegarde, supervision, PRA/PCA</li>
                            <li class="dashboard-band">Mise en place d'infrastructures s√©curis√©es (SIEM, IDS/IPS)</li>
                        </ul>
                    </div>
                    <div class="dashboard-band">
                        <h4>D√©bouch√©s possibles :</h4>
                        <ul>
                            <li class="dashboard-band">Administrateur syst√®mes/r√©seaux, Ing√©nieur s√©curit√©, DevOps, DBA</li>
                        </ul>
                    </div>
                `;
            } else if (formation === 'DEVIA') {
                dashboardContent = `
                    <div class="dashboard-band">
                        <h4>DEVIA ‚Äì D√©veloppement Informatique et Intelligence Artificielle</h4>
                    </div>
                    <div class="dashboard-band">
                        <h5>Objectifs :</h5>
                        <ul>
                            <li class="dashboard-band">Former des d√©veloppeurs fullstack sp√©cialis√©s en IA et data science.</li>
                            <li class="dashboard-band">Ma√Ætriser les langages de programmation, le web, les bases de donn√©es et les algorithmes d'IA.</li>
                            <li class="dashboard-band">Comprendre l‚Äô√©thique de l‚ÄôIA, les enjeux du machine learning et du deep learning.</li>
                        </ul>
                    </div>
                    <div class="dashboard-band">
                        <h5>Programme type :</h5>
                        <ul>
                            <li class="dashboard-band">D√©veloppement Web & Mobile (HTML, CSS, JavaScript, React, Node.js‚Ä¶)</li>
                            <li class="dashboard-band">Programmation orient√©e objet (Python, Java, C#‚Ä¶)</li>
                            <li class="dashboard-band">Intelligence Artificielle (r√©gression, classification, r√©seaux de neurones)</li>
                            <li class="dashboard-band">Machine Learning / Deep Learning (scikit-learn, TensorFlow, Keras‚Ä¶)</li>
                            <li class="dashboard-band">Bases de donn√©es (MySQL, PostgreSQL, MongoDB‚Ä¶)</li>
                            <li class="dashboard-band">API et microservices (REST, GraphQL)</li>
                            <li class="dashboard-band">DevOps, int√©gration continue</li>
                            <li class="dashboard-band">Projets IA appliqu√©s (chatbot, analyse pr√©dictive, NLP‚Ä¶)</li>
                        </ul>
                    </div>
                    <div class="dashboard-band">
                        <h4>D√©bouch√©s possibles :</h4>
                        <ul>
                            <li class="dashboard-band">D√©veloppeur fullstack, Data Scientist, Ing√©nieur IA, Data Analyst</li>
                        </ul>
                    </div>
                `;
            } else if (formation === 'EISI') {
                dashboardContent = `
                    <div class="dashboard-band">
                        <h4>EISI ‚Äì Expert en Ing√©nierie des Syst√®mes d‚ÄôInformation</h4>
                    </div>
                    <div class="dashboard-band">
                        <h5>Objectifs :</h5>
                        <ul>
                            <li class="dashboard-band">Former des experts en architecture SI, capables de piloter des projets complexes.</li>
                            <li class="dashboard-band">Conna√Ætre les enjeux de la transformation digitale, du cloud, de la data et du pilotage SI.</li>
                            <li class="dashboard-band">D√©velopper une approche strat√©gique, technique et manag√©riale.</li>
                        </ul>
                    </div>
                    <div class="dashboard-band">
                        <h5>Programme type :</h5>
                        <ul>
                            <li class="dashboard-band">Architecture des SI (urbanisation, cloud, big data)</li>
                            <li class="dashboard-band">Gouvernance & strat√©gie SI</li>
                            <li class="dashboard-band">Management de projet (Agile, Scrum, Prince2)</li>
                            <li class="dashboard-band">Cybers√©curit√© avanc√©e (audit, normes ISO 27001, RGPD‚Ä¶)</li>
                            <li class="dashboard-band">Business Intelligence & Data Management</li>
                            <li class="dashboard-band">Infrastructure Cloud & Virtualisation</li>
                            <li class="dashboard-band">Innovation & veille technologique</li>
                            <li class="dashboard-band">D√©veloppement d‚Äôapplication √† l‚Äô√©chelle (architecture microservices)</li>
                        </ul>
                    </div>
                    <div class="dashboard-band">
                        <h4>D√©bouch√©s possibles :</h4>
                        <ul>
                            <li class="dashboard-band">Architecte SI, DSI, Chef de projet IT, Consultant IT, Expert cloud</li>
                        </ul>
                    </div>
                `;
            }
            document.getElementById('dashboardContent').innerHTML = dashboardContent;
        })
        .catch(error => console.error('Erreur:', error));
    }

    function loadProfile() {
        document.getElementById('dashboardSection').style.display = 'none';
        document.getElementById('profileSection').style.display = 'block';
        fetch(`http://localhost:5000/user_data?email=${encodeURIComponent(userData.email)}`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            console.log('Donn√©es re√ßues dans loadProfile:', data); // D√©bogage
            const formation = data.formation;
            let fields = {};
            if (formation === 'ASRBD') {
                fields = {
                    'Civilit√©': data.form.Civilit√© || '', 'Nom': data.form.Nom || '', 'Pr√©nom': data.form.Pr√©nom || '',
                    'Date de Naissance': data.form.Date_de_Naissance || '', 'Lieu de Naissance': data.form.Lieu_de_Naissance || '',
                    'D√©partement de Naissance': data.form.D√©partement_de_Naissance || '', 'Pays': data.form.Pays || '',
                    'Adresse': data.form.Adresse || '', 'CP': data.form.CP || '', 'Ville': data.form.Ville || '',
                    'Tel Fixe': data.form.Tel_Fixe || '', 'Tel Mobile': data.form.Tel_Mobile || '',
                    'Adresse mail personnelle': data.form.Adresse_mail_personnelle || '',
                    'Dipl√¥me ou niveau d‚Äô√©tudes': data.form.Dipl√¥me_ou_niveau_d_√©tudes || '',
                    'Exp√©rience professionnelle': data.form.Exp√©rience_professionnelle || '', 'Financement': data.form.Financement || ''
                };
            } else if (formation === 'EISI' || formation === 'DEVIA') {
                fields = {
                    'Civilit√©': data.form.Civilit√© || '', 'ID Candidat (IGOR)': data.form.ID_Candidat_IGOR || '',
                    'Identifiant candidat': data.form.Identifiant_candidat || '', 'Campus': data.form.Campus || '',
                    'Nom de naissance': data.form.Nom_de_naissance || '', 'Pr√©nom': data.form.Pr√©nom || '',
                    'Date de naissance': data.form.Date_de_naissance || '', 'Code postal ville de naissance': data.form.Code_postal_ville_naissance || '',
                    'Lieu de naissance (Ville)': data.form.Lieu_de_naissance_ville || '', 'Pays de naissance': data.form.Pays_de_naissance || '',
                    'Nationalit√©': data.form.Nationalit√© || '', 'Intitul√© du dernier dipl√¥me': data.form.Dernier_dipl√¥me || '',
                    'Niveau du dernier dipl√¥me': data.form.Niveau_dernier_dipl√¥me || '', 'Ann√©e d‚Äôobtention': data.form.Ann√©e_d_obtention || '',
                    'D√©cision du jury': data.form.D√©cision_du_jury || '', 'Ann√©e de premi√®re inscription': data.form.Ann√©e_de_premi√®re_inscription || '',
                    'Voie d‚Äôacc√®s': data.form.Voie_d_acc√®s || '', 'Situation avant cursus': data.form.Situation_avant_cursus || '',
                    'Dernier m√©tier exerc√©': data.form.Dernier_m√©tier || '', 'Nom de l‚Äôentreprise': data.form.Nom_de_l_entreprise || '',
                    'Dur√©e de l‚Äôexp√©rience': data.form.Dur√©e_de_l_exp√©rience || '', 'T√©l√©phone portable personnel': data.form.T√©l√©phone_portable || '',
                    'Adresse mail personnelle': data.form.Adresse_mail_personnelle || ''
                };
            }
            let tableHtml = '<thead><tr><th>Informations</th><th>Valeur</th></tr></thead><tbody>';
            for (let field in fields) {
                tableHtml += `<tr><td>${field}</td><td>${fields[field] || 'Non renseign√©'}</td></tr>`; // Afficher 'Non renseign√©' si vide
            }
            tableHtml += '</tbody>';
            document.getElementById('profileData').innerHTML = tableHtml;

            const prenom = fields['Pr√©nom'] || '';
            const nom = fields['Nom'] || fields['Nom de naissance'] || '';
            const initials = (prenom.charAt(0) + (nom.charAt(0) || '')).toUpperCase() || '??';
            document.getElementById('profileImage').textContent = initials.substring(0, 2);
            document.getElementById('profileImageHeader').textContent = initials.substring(0, 2);
            document.getElementById('profileName').textContent = `${prenom} ${nom}`.trim() || 'Inconnu';

            document.getElementById('cameraIcon').addEventListener('click', function() {
                document.getElementById('profileUpload').click();
            });
            document.getElementById('profileUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('profileImage').innerHTML = `<img src="${e.target.result}" alt="Profile Image" class="profile-img">`;
                        document.getElementById('profileImageHeader').innerHTML = `<img src="${e.target.result}" alt="Profile Image" style="height: 40px; border-radius: 50%;">`;
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('changeFormation').addEventListener('click', function() {
                fetch('http://localhost:5000/change_formation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userData.email, formation: '' })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.next === 'form') {
                        userData.formation = '';
                        localStorage.setItem('userData', JSON.stringify(userData));
                        document.getElementById('profileSection').style.display = 'none';
                        loadForm();
                    }
                })
                .catch(error => console.error('Erreur:', error));
            });
        })
        .catch(error => console.error('Erreur:', error));
    }

    document.getElementById('logout').addEventListener('click', function(e) {
        e.preventDefault();
        userData = {};
        localStorage.removeItem('userData');
        document.getElementById('header').style.display = 'none';
        document.getElementById('dashboardSection').style.display = 'none';
        document.getElementById('profileSection').style.display = 'none';
        document.getElementById('loginSection').style.display = 'block';
        fetch('http://localhost:5000/delete_data?email=' + encodeURIComponent(userData.email), {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => console.log('D√©connexion:', data))
        .catch(error => console.error('Erreur:', error));
    });

    document.getElementById('editProfile').addEventListener('click', function() {
        console.log('Bouton Modifier cliqu√©');
    });
  </script>
</body>
</html>